{% extends "base.html" %}
{% block title %}Home{% endblock %}

{% block content %}
<!--  search bar -->
<div class="max-w-md mx-auto my-6">
  <div class="relative">
    <input id="searchInput" type="text"
           placeholder="Search team or tournament"
           class="w-full h-12 pl-12 pr-4 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 text-xl">
    <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-500">
      <i class="fa fa-search"></i>
    </span>
  </div>
</div>

<!-- tournament grid -->
<div class="max-w-7xl mx-auto px-4 pb-10">
  <div id="tourGrid" class="grid gap-8"></div>
</div>

<!--  ES‑module script -->
<script type="module">
  import { api } from "/static/js/apiClient.js";

  const grid   = document.getElementById("tourGrid");
  const search = document.getElementById("searchInput");
  let  allData = await api.get("/leaderboard/grouped");

  /* helpers */
  const rankBadge = r => ({
      1:"bg-yellow-500", 2:"bg-red-500", 3:"bg-green-500"
  }[r] || "bg-gray-300");

  const teamCard = t => `
    <div class="bg-gray-100 rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between">
        <div class="text-xl font-semibold text-gray-800">${t.name}</div>
        <div class="${rankBadge(t.rank)} text-white px-3 py-1 rounded-lg text-sm">
          Rank ${t.rank}
        </div>
      </div>
      <p class="text-gray-600 mt-2">Points: ${t.points}</p>
      <button class="bg-blue-500 hover:bg-blue-400 text-white rounded-lg py-2 px-4 text-sm mt-4 transition duration-300"
              onclick="location.href='/SingleTeam?team=${encodeURIComponent(t.name)}'">
        View Details
      </button>
    </div>`;

  const playerCard = p => `
    <div class="bg-white border rounded-lg shadow p-4 flex justify-between items-center">
      <div class="font-medium">${p.name}</div>
      <div class="${rankBadge(p.rank)} text-white text-xs px-2 py-0.5 rounded">#${p.rank}</div>
      <div class="font-semibold">${p.goals} ${p.goals===1?'goal':'goals'}</div>
    </div>`;

  const tourCard = ({tournament, topTeams, topPlayers}) => `
    <div class="bg-white rounded-lg shadow-lg p-6 w-full">
      <h2 class="text-2xl font-semibold text-center mb-6 text-blue-600">
        ${tournament.name}
      </h2>

      <!-- top teams -->
      <h3 class="text-xl font-semibold mb-4">Top Teams</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        ${topTeams.map(teamCard).join("")}
      </div>

      <!-- top players -->
      <h3 class="text-xl font-semibold mb-4">Top Players</h3>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        ${topPlayers.length
            ? topPlayers.map(playerCard).join("")
            : '<p class="text-gray-500 col-span-full">No scorer data yet.</p>'}
      </div>
    </div>`;

  /* render & search */
  function render(data){
    grid.innerHTML = data.length
      ? data.map(tourCard).join("")
      : '<p class="text-center text-gray-500 w-full">No results</p>';
  }
  render(allData);

  search.addEventListener("input", () => {
    const q = search.value.trim().toLowerCase();
    if (!q) { render(allData); return; }

    const filtered = allData.filter(t =>
        t.tournament.name.toLowerCase().includes(q) ||
        t.topTeams.some(tm => tm.name.toLowerCase().includes(q)));
    render(filtered);
  });
</script>
{% endblock %}
