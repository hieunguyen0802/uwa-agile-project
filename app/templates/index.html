{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}

<!-- search bar -->
<div class="max-w-md mx-auto my-4">
  <div class="relative">
    <input id="searchInput" type="text" placeholder="Search team or tournament"
           class="w-full h-12 pl-12 pr-4 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 text-xl">
    <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-500">
      <i class="fa fa-search"></i>
    </span>
  </div>
</div>
<!-- 
// Tournament grid  -->
<div class="max-w-7xl mx-auto px-4 pb-10">
  <div id="tourGrid" class="space-y-8"></div>
</div>

<!-- cards -->
<script type="module">
  const apiGet = p => fetch(p).then(r => r.json());

  const grid   = document.getElementById("tourGrid");
  const search = document.getElementById("searchInput");
  let allData  = [];

  // rank badge colour 
  const badge = r => r === 1 ? "bg-yellow-500" : r === 2 ? "bg-gray-500" : "bg-brown-500";

  // build team card
  const teamCard = t => `
    <div class="bg-gray-100 rounded-lg shadow-sm p-4 team"
         data-name="${t.name.toLowerCase()}">
      <div class="flex items-center justify-between">
        <span class="font-semibold text-gray-800">${t.name}</span>
        <span class="${badge(t.rank)} text-white px-2 py-0.5 rounded text-xs">#${t.rank}</span>
      </div>
      <p class="text-gray-600 text-sm mt-1">PtsÂ ${t.points}</p>
      <button class="mt-2 bg-blue-500 hover:bg-blue-400 text-white text-xs py-1 px-3 rounded">
        View Details
      </button>
    </div>`;

  // build tournament card with inner grid
  const tourCard = t => `
    <div class="bg-white rounded-lg shadow-lg p-6 tournament"
         data-name="${t.tournament.name.toLowerCase()}">
      <h2 class="text-2xl font-semibold text-blue-600 mb-4">
        ${t.tournament.name}
      </h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        ${t.teams.map(teamCard).join("")}
      </div>
    </div>`;

  // render helper
  function render(data){
    grid.innerHTML = data.map(tourCard).join("");
  }

  // fetch data on load
  apiGet("/api/leaderboard/grouped").then(data=>{
    allData = data;
    render(data);
  });

  // search filter
  search.addEventListener("input", ()=>{
    const q = search.value.trim().toLowerCase();
    if(!q){ render(allData); return; }

    const filtered = allData
      .map(t => ({
        ...t,
        teams: t.teams.filter(team => team.name.toLowerCase().includes(q))
      }))
      .filter(t => t.tournament.name.toLowerCase().includes(q) || t.teams.length);

    render(filtered);
  });
</script>
{% endblock %}
